<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processor</title>
     <style>
        /* Basic CSS styles for visial presentation */
        body {
            background-color: lch(98.81% 27.73 108.07); /* This is the light yellow-green color */
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #222;
            margin-bottom: 0;
        }

        form {
             margin-top: 20px;
        }

        input[type="file"], select, button {
            margin: 10px;
            padding: 8px;
             font-size: 1rem;
        }

        button {
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #005fa3;
        }

        hr {
            margin: 30px 0;
        }

        /* Styling for #result */
        #result {
            margin-top: 30px;
            padding: 15px;
            background-color: #fff; /* This is the white rectangular area */
            border-radius: 10px;
            box-shadow: 0px 2px 6px rgba(0,0,0,0.1);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        img {
             max-width: 300px;
            border-radius: 8px;
            margin-top: 15px;
    }

        /* Style for the temporary loading message */
        .loading-message {
            margin: 10px 0;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>GameLens</h1>
    <h3>Snap the Play. Get the Stats. Write the Caption.</h3>
    <hr>
    <p> Upload a recent image of a sports player to get player statistics and an Instagram caption generated by Gemini AI.</p>
        <form id="uploadForm" enctype="multipart/form-data">
    <label for="player_image"><strong>Select player image:</strong></label>
    <input type="file" id="player_image" name="player_image" accept="image/*" required>

    <br><br>

    <strong>Choose sport:</strong><br>
    <label>
        <input type="radio" name="sport" value="NBA" required> NBA
    </label>

    <br><br>
    <button type="submit">Upload & Process</button>
</form>


    <hr>

        <div id="result"></div>

<script>
document.getElementById('uploadForm').addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    const resultDiv = document.getElementById('result');

    // Add a temporary loading message at the top
    const loadingHtml = `
        <div class="loading-message">
            <em>Processing your image... please wait.</em>
        </div>`;
    resultDiv.insertAdjacentHTML('afterbegin', loadingHtml);

    // Keep a reference to remove it later
    const currentLoadingMessage = resultDiv.querySelector('.loading-message');

    try {
        const response = await fetch('/upload', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (!response.ok) throw new Error(data.error || "Upload failed");

        const playerInfo = data.player_info;

        if (playerInfo.status === 'error') throw new Error(playerInfo.message);

        // Remove temporary loading message
        currentLoadingMessage?.remove();

        // Combine outputs
        const statsSummary = playerInfo.stats_summary;
        const captionOutput = playerInfo.caption_output;

        const combinedOutput = `
            ${statsSummary}<br><br><br><strong>${captionOutput}</strong>
        `;

        //Add final result block at the top
        const newResultHTML = `
            <div class="player-result">
                <h2>Result</h2>
                <p><strong>Sport chosen:</strong> ${data.sport}</p>
                <img src="${data.image_url}" alt="Uploaded Player">
                <p><strong>Player Information:</strong></p>
                <p style="text-align: left; padding: 0 20px;">${combinedOutput}</p>
                <hr>
            </div>
        `;
        resultDiv.insertAdjacentHTML('afterbegin', newResultHTML);

    } catch (error) {
        // Remove temporary loading message
        currentLoadingMessage?.remove();

        //Add error message at the top
        resultDiv.insertAdjacentHTML('afterbegin', `
            <p style="color:red;">
                <strong>Error:</strong> ${error.message}
            </p>
        `);
    }
});
</script>


</body>
</html>